<!-- apps/web/src/lib/components/ui/TabNav.svelte -->
<script lang="ts" context="module">
	import type { ComponentType } from 'svelte';

	export interface Tab {
		id: string;
		label: string;
		icon?: ComponentType;
		count?: number;
		hideCount?: boolean;
	}
</script>

<script lang="ts">
	import { createEventDispatcher } from 'svelte';

	export let tabs: Tab[] = [];
	export let activeTab: string;
	export let containerClass = '';
	export let navClass = '';
	export let ariaLabel = 'Tabs';

	const dispatch = createEventDispatcher<{
		change: string;
	}>();

	function handleTabClick(tabId: string) {
		if (tabId !== activeTab) {
			dispatch('change', tabId);
		}
	}
</script>

<div class="tab-container {containerClass}">
	<div class="tab-nav {navClass}" role="tablist" aria-label={ariaLabel}>
		{#each tabs as tab (tab.id)}
			<button
				type="button"
				role="tab"
				aria-selected={activeTab === tab.id}
				aria-controls="{tab.id}-panel"
				onclick={() => handleTabClick(tab.id)}
				class="tab-button {activeTab === tab.id ? 'tab-active' : 'tab-inactive'}"
			>
				{#if tab.icon}
					{@const TabIcon = tab.icon}
					<TabIcon class="tab-icon" />
				{/if}
				<span class="tab-label">{tab.label}</span>
				{#if !tab.hideCount && tab.count !== undefined}
					<span
						class="tab-badge {activeTab === tab.id ? 'badge-active' : 'badge-inactive'}"
					>
						{tab.count}
					</span>
				{/if}
			</button>
		{/each}
	</div>
</div>

<style>
	/* Apple-quality tab container with Tailwind colors */
	.tab-container {
		@apply border-b border-gray-200 dark:border-gray-700 relative;
	}

	/* Tab navigation with smooth scrolling */
	.tab-nav {
		@apply flex gap-1 overflow-x-auto overflow-y-hidden px-2 mb-[-1px];
		-webkit-overflow-scrolling: touch;
		scroll-behavior: smooth;
		scrollbar-width: none;
		-ms-overflow-style: none;
	}

	.tab-nav::-webkit-scrollbar {
		display: none;
	}

	@media (min-width: 640px) {
		.tab-nav {
			@apply px-0 gap-2;
		}
	}

	/* Tab button - Apple-refined with Tailwind colors */
	.tab-button {
		@apply inline-flex items-center justify-center gap-2 py-3 px-4 border-b-2 border-transparent bg-transparent text-sm font-medium text-gray-700 dark:text-gray-300 whitespace-nowrap cursor-pointer transition-all duration-200 relative outline-none min-h-[44px] flex-shrink-0;
	}

	@media (min-width: 640px) {
		.tab-button {
			@apply py-3.5 px-5 gap-2.5;
		}
	}

	/* Active tab - refined with Tailwind */
	.tab-active {
		@apply border-b-2 border-blue-500 dark:border-blue-400 text-blue-600 dark:text-blue-400 font-semibold bg-gradient-to-b from-blue-500/5 to-blue-500/8 dark:from-blue-400/8 dark:to-blue-400/12;
	}

	/* Inactive tab - subtle */
	.tab-inactive {
		@apply border-b-2 border-transparent text-gray-600 dark:text-gray-400;
	}

	/* Hover state */
	.tab-inactive:hover {
		@apply text-gray-900 dark:text-gray-100 border-b-2 border-gray-300 dark:border-gray-600 bg-gradient-to-b from-black/2 to-black/3 dark:from-white/3 dark:to-white/5;
	}

	/* Focus state for keyboard navigation */
	.tab-button:focus-visible {
		@apply outline-blue-500 dark:outline-blue-400 outline-offset-[-2px] outline-2 rounded-sm;
	}

	/* Active state on press */
	.tab-button:active {
		transform: scale(0.98);
	}

	/* Tab icon - Apple-refined sizing */
	.tab-icon {
		@apply w-4 h-4 flex-shrink-0 transition-transform duration-200;
	}

	@media (min-width: 640px) {
		.tab-icon {
			@apply w-4.5 h-4.5;
		}
	}

	.tab-active .tab-icon {
		transform: scale(1.05);
	}

	/* Tab label */
	.tab-label {
		font-variant-numeric: tabular-nums;
		-webkit-font-smoothing: antialiased;
		-moz-osx-font-smoothing: grayscale;
	}

	/* Count badge - elegant with Tailwind colors */
	.tab-badge {
		@apply inline-flex items-center justify-center px-2 py-0.5 text-xs font-semibold rounded-full transition-all duration-200 min-w-[1.5rem];
		font-variant-numeric: tabular-nums;
	}

	.badge-active {
		@apply bg-blue-100 dark:bg-blue-950/30 text-blue-700 dark:text-blue-200;
	}

	.badge-inactive {
		@apply bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400;
	}

	.tab-inactive:hover .badge-inactive {
		@apply bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300;
	}

	/* Reduce motion for accessibility */
	@media (prefers-reduced-motion: reduce) {
		.tab-button,
		.tab-icon,
		.tab-badge {
			transition: none;
		}

		.tab-button:active {
			transform: none;
		}

		.tab-active .tab-icon {
			transform: none;
		}
	}
</style>
