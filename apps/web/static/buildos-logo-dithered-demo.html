<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>BuildOS Logo - Dithering Demo</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family:
					system-ui,
					-apple-system,
					BlinkMacSystemFont,
					'Segoe UI',
					sans-serif;
				padding: 2rem;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				min-height: 100vh;
			}

			.container {
				max-width: 1400px;
				margin: 0 auto;
			}

			h1 {
				font-size: 2.5rem;
				font-weight: 800;
				margin-bottom: 0.5rem;
				color: white;
				text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
			}

			.subtitle {
				color: rgba(255, 255, 255, 0.9);
				margin-bottom: 2rem;
				font-size: 1.1rem;
			}

			.controls {
				background: white;
				border-radius: 12px;
				padding: 1.5rem;
				margin-bottom: 2rem;
				box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
			}

			.control-group {
				display: flex;
				gap: 2rem;
				flex-wrap: wrap;
				align-items: center;
			}

			.control {
				display: flex;
				flex-direction: column;
				gap: 0.5rem;
			}

			label {
				font-weight: 600;
				font-size: 0.875rem;
				color: #374151;
			}

			select,
			input[type='range'] {
				padding: 0.5rem;
				border: 2px solid #e5e7eb;
				border-radius: 6px;
				font-size: 1rem;
				background: white;
			}

			select:focus,
			input:focus {
				outline: none;
				border-color: #9333ea;
			}

			input[type='range'] {
				width: 200px;
			}

			.value-display {
				font-weight: 700;
				color: #9333ea;
			}

			.grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
				gap: 2rem;
				margin-bottom: 2rem;
			}

			.card {
				background: white;
				border-radius: 12px;
				padding: 2rem;
				box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
			}

			.card-title {
				font-weight: 700;
				font-size: 1.25rem;
				margin-bottom: 1rem;
				color: #111827;
			}

			.canvas-container {
				display: flex;
				align-items: center;
				justify-content: center;
				padding: 2rem;
				background: #f9fafb;
				border-radius: 8px;
				min-height: 200px;
			}

			canvas {
				max-width: 100%;
				height: auto;
				image-rendering: pixelated;
			}

			.info {
				margin-top: 1rem;
				padding: 1rem;
				background: #f3f4f6;
				border-radius: 6px;
				font-size: 0.875rem;
				color: #6b7280;
			}

			.comparison {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
				gap: 2rem;
			}

			.download-btn {
				margin-top: 1rem;
				padding: 0.75rem 1.5rem;
				background: linear-gradient(135deg, #9333ea 0%, #2563eb 100%);
				color: white;
				border: none;
				border-radius: 8px;
				font-weight: 600;
				cursor: pointer;
				transition: transform 0.2s;
			}

			.download-btn:hover {
				transform: translateY(-2px);
				box-shadow: 0 4px 12px rgba(147, 51, 234, 0.4);
			}

			.download-btn:active {
				transform: translateY(0);
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>BuildOS Logo - Dithering Effect Demo</h1>
			<p class="subtitle">Retro ordered dithering using Bayer matrix algorithm</p>

			<div class="controls">
				<div class="control-group">
					<div class="control">
						<label for="matrixSize">Bayer Matrix Size</label>
						<select id="matrixSize">
							<option value="2">2×2 (Coarse)</option>
							<option value="4" selected>4×4 (Balanced)</option>
							<option value="8">8×8 (Fine)</option>
						</select>
					</div>

					<div class="control">
						<label for="bitDepth"
							>Color Bit Depth:
							<span class="value-display" id="bitDepthValue">1-bit</span></label
						>
						<input type="range" id="bitDepth" min="1" max="8" value="1" step="1" />
					</div>

					<div class="control">
						<label for="scale"
							>Scale Factor:
							<span class="value-display" id="scaleValue">2x</span></label
						>
						<input type="range" id="scale" min="1" max="4" value="2" step="1" />
					</div>

					<div class="control">
						<label for="theme">Logo Theme</label>
						<select id="theme">
							<option value="light" selected>Light Mode</option>
							<option value="dark">Dark Mode</option>
						</select>
					</div>
				</div>
			</div>

			<div class="grid">
				<div class="card">
					<h2 class="card-title">Original Logo</h2>
					<div class="canvas-container">
						<canvas id="originalCanvas"></canvas>
					</div>
					<div class="info">
						Vector SVG with gradient from purple (#9333ea) to blue (#2563eb)
					</div>
				</div>

				<div class="card">
					<h2 class="card-title">Dithered Logo</h2>
					<div class="canvas-container">
						<canvas id="ditheredCanvas"></canvas>
					</div>
					<button class="download-btn" id="downloadBtn">Download Dithered PNG</button>
					<div class="info" id="ditheredInfo">Bayer 4×4 matrix, 1-bit color depth</div>
				</div>
			</div>

			<div class="card">
				<h2 class="card-title">Gallery: All Dithering Variations</h2>
				<div class="comparison" id="gallery"></div>
			</div>
		</div>

		<script>
			// Bayer Matrix Dithering Implementation
			class BayerDithering {
				static BAYER_MATRICES = {
					2: [
						[0, 2],
						[3, 1]
					],
					4: [
						[0, 8, 2, 10],
						[12, 4, 14, 6],
						[3, 11, 1, 9],
						[15, 7, 13, 5]
					],
					8: [
						[0, 32, 8, 40, 2, 34, 10, 42],
						[48, 16, 56, 24, 50, 18, 58, 26],
						[12, 44, 4, 36, 14, 46, 6, 38],
						[60, 28, 52, 20, 62, 30, 54, 22],
						[3, 35, 11, 43, 1, 33, 9, 41],
						[51, 19, 59, 27, 49, 17, 57, 25],
						[15, 47, 7, 39, 13, 45, 5, 37],
						[63, 31, 55, 23, 61, 29, 53, 21]
					]
				};

				constructor(matrixSize = 4) {
					this.matrixSize = matrixSize;
					this.matrix = BayerDithering.BAYER_MATRICES[matrixSize];
					this.normalizedMatrix = this.normalizeMatrix();
				}

				normalizeMatrix() {
					const divisor = this.matrixSize * this.matrixSize;
					return this.matrix.map((row) => row.map((val) => val / divisor));
				}

				applyDithering(imageData, bitDepth = 1) {
					const data = imageData.data;
					const width = imageData.width;
					const height = imageData.height;

					const levels = Math.pow(2, bitDepth);
					const stepSize = 256 / (levels - 1);

					for (let i = 0; i < data.length; i += 4) {
						const pixelIndex = i / 4;
						const x = pixelIndex % width;
						const y = Math.floor(pixelIndex / width);

						const matX = x % this.matrixSize;
						const matY = y % this.matrixSize;
						const threshold = this.normalizedMatrix[matY][matX];

						// Apply dithering to RGB channels
						for (let c = 0; c < 3; c++) {
							const colorValue = data[i + c] / 255;
							const ditherValue = colorValue + (threshold - 0.5);
							const quantized = this.quantizeColor(ditherValue, levels);
							data[i + c] = quantized;
						}
					}

					return imageData;
				}

				quantizeColor(value, levels) {
					const clamped = Math.max(0, Math.min(1, value));
					const quantized = Math.round(clamped * (levels - 1)) / (levels - 1);
					return Math.round(quantized * 255);
				}
			}

			// Logo rendering and dithering application
			class LogoDitherer {
				constructor() {
					this.baseWidth = 300;
					this.baseHeight = 80;
					this.scale = 2;
					this.matrixSize = 4;
					this.bitDepth = 1;
					this.theme = 'light';

					this.originalCanvas = document.getElementById('originalCanvas');
					this.ditheredCanvas = document.getElementById('ditheredCanvas');

					this.setupControls();
					this.render();
				}

				setupControls() {
					document.getElementById('matrixSize').addEventListener('change', (e) => {
						this.matrixSize = parseInt(e.target.value);
						this.render();
					});

					document.getElementById('bitDepth').addEventListener('input', (e) => {
						this.bitDepth = parseInt(e.target.value);
						const levels = Math.pow(2, this.bitDepth);
						document.getElementById('bitDepthValue').textContent =
							`${this.bitDepth}-bit (${levels} colors)`;
						this.render();
					});

					document.getElementById('scale').addEventListener('input', (e) => {
						this.scale = parseInt(e.target.value);
						document.getElementById('scaleValue').textContent = `${this.scale}x`;
						this.render();
					});

					document.getElementById('theme').addEventListener('change', (e) => {
						this.theme = e.target.value;
						this.render();
					});

					document.getElementById('downloadBtn').addEventListener('click', () => {
						this.downloadDitheredLogo();
					});
				}

				async render() {
					await this.renderOriginal();
					await this.renderDithered();
					this.updateInfo();
					this.renderGallery();
				}

				async renderOriginal() {
					const canvas = this.originalCanvas;
					const width = this.baseWidth * this.scale;
					const height = this.baseHeight * this.scale;

					canvas.width = width;
					canvas.height = height;

					const ctx = canvas.getContext('2d');

					// Create gradient
					const gradient = ctx.createLinearGradient(0, 0, width, 0);
					if (this.theme === 'light') {
						gradient.addColorStop(0, '#9333ea');
						gradient.addColorStop(1, '#2563eb');
					} else {
						gradient.addColorStop(0, '#c084fc');
						gradient.addColorStop(1, '#60a5fa');
					}

					// Draw text
					ctx.fillStyle = gradient;
					ctx.font = `800 ${48 * this.scale}px system-ui, -apple-system, sans-serif`;
					ctx.textAlign = 'center';
					ctx.textBaseline = 'middle';
					ctx.fillText('BuildOS', width / 2, height / 2 + 5 * this.scale);
				}

				async renderDithered() {
					// First render to a temporary canvas
					const tempCanvas = document.createElement('canvas');
					const width = this.baseWidth * this.scale;
					const height = this.baseHeight * this.scale;

					tempCanvas.width = width;
					tempCanvas.height = height;

					const ctx = tempCanvas.getContext('2d');

					// Create gradient
					const gradient = ctx.createLinearGradient(0, 0, width, 0);
					if (this.theme === 'light') {
						gradient.addColorStop(0, '#9333ea');
						gradient.addColorStop(1, '#2563eb');
					} else {
						gradient.addColorStop(0, '#c084fc');
						gradient.addColorStop(1, '#60a5fa');
					}

					// Draw text
					ctx.fillStyle = gradient;
					ctx.font = `800 ${48 * this.scale}px system-ui, -apple-system, sans-serif`;
					ctx.textAlign = 'center';
					ctx.textBaseline = 'middle';
					ctx.fillText('BuildOS', width / 2, height / 2 + 5 * this.scale);

					// Get image data and apply dithering
					const imageData = ctx.getImageData(0, 0, width, height);
					const ditherer = new BayerDithering(this.matrixSize);
					ditherer.applyDithering(imageData, this.bitDepth);

					// Put dithered image on main canvas
					this.ditheredCanvas.width = width;
					this.ditheredCanvas.height = height;
					const ditheredCtx = this.ditheredCanvas.getContext('2d');
					ditheredCtx.putImageData(imageData, 0, 0);
				}

				updateInfo() {
					const levels = Math.pow(2, this.bitDepth);
					const info = `Bayer ${this.matrixSize}×${this.matrixSize} matrix, ${this.bitDepth}-bit color depth (${levels} colors per channel)`;
					document.getElementById('ditheredInfo').textContent = info;
				}

				renderGallery() {
					const gallery = document.getElementById('gallery');
					gallery.innerHTML = '';

					const variations = [
						{ matrix: 2, bits: 1, label: '2×2 Matrix, 1-bit' },
						{ matrix: 4, bits: 1, label: '4×4 Matrix, 1-bit' },
						{ matrix: 8, bits: 1, label: '8×8 Matrix, 1-bit' },
						{ matrix: 4, bits: 2, label: '4×4 Matrix, 2-bit' },
						{ matrix: 4, bits: 3, label: '4×4 Matrix, 3-bit' },
						{ matrix: 8, bits: 2, label: '8×8 Matrix, 2-bit' }
					];

					variations.forEach(({ matrix, bits, label }) => {
						const card = document.createElement('div');
						card.style.cssText = `
                        background: #f9fafb;
                        border-radius: 8px;
                        padding: 1rem;
                        text-align: center;
                    `;

						const title = document.createElement('div');
						title.style.cssText = `
                        font-weight: 600;
                        margin-bottom: 0.5rem;
                        color: #374151;
                    `;
						title.textContent = label;

						const canvas = document.createElement('canvas');
						this.renderVariation(canvas, matrix, bits);

						card.appendChild(title);
						card.appendChild(canvas);
						gallery.appendChild(card);
					});
				}

				renderVariation(canvas, matrixSize, bitDepth) {
					const width = this.baseWidth * this.scale;
					const height = this.baseHeight * this.scale;

					canvas.width = width;
					canvas.height = height;
					canvas.style.imageRendering = 'pixelated';
					canvas.style.maxWidth = '100%';
					canvas.style.height = 'auto';

					const ctx = canvas.getContext('2d');

					// Create gradient
					const gradient = ctx.createLinearGradient(0, 0, width, 0);
					if (this.theme === 'light') {
						gradient.addColorStop(0, '#9333ea');
						gradient.addColorStop(1, '#2563eb');
					} else {
						gradient.addColorStop(0, '#c084fc');
						gradient.addColorStop(1, '#60a5fa');
					}

					// Draw text
					ctx.fillStyle = gradient;
					ctx.font = `800 ${48 * this.scale}px system-ui, -apple-system, sans-serif`;
					ctx.textAlign = 'center';
					ctx.textBaseline = 'middle';
					ctx.fillText('BuildOS', width / 2, height / 2 + 5 * this.scale);

					// Apply dithering
					const imageData = ctx.getImageData(0, 0, width, height);
					const ditherer = new BayerDithering(matrixSize);
					ditherer.applyDithering(imageData, bitDepth);
					ctx.putImageData(imageData, 0, 0);
				}

				downloadDitheredLogo() {
					const dataUrl = this.ditheredCanvas.toDataURL('image/png');
					const link = document.createElement('a');
					link.download = `buildos-logo-dithered-${this.matrixSize}x${this.matrixSize}-${this.bitDepth}bit.png`;
					link.href = dataUrl;
					link.click();
				}
			}

			// Initialize when page loads
			window.addEventListener('DOMContentLoaded', () => {
				new LogoDitherer();
			});
		</script>
	</body>
</html>
